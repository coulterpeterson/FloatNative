(()=>{"use strict";var e=function(e,t,n,o){return new(n||(n=Promise))(function(i,s){function l(e){try{a(o.next(e))}catch(e){s(e)}}function d(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,d)}a((o=o.apply(e,t||[])).next())})};function t(){const t=document.createElement("div");return t.className="fp-playlist-button",t.title="Save to Playlist",t.innerHTML='<i class="material-icons" aria-hidden="true" style="font-size: 22px; cursor: pointer;">playlist_add</i>',t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.height="40px",t.style.borderRadius="50%",t.style.cursor="pointer",t.style.color="inherit",t.onmouseover=()=>{t.style.backgroundColor="rgba(255,255,255,0.1)"},t.onmouseout=()=>{t.style.backgroundColor="transparent"},t.onclick=n=>e(this,void 0,void 0,function*(){n.preventDefault(),n.stopPropagation();const s=document.querySelector(".fp-playlist-dropdown");if(s)s.remove();else{t.style.cursor="wait";try{const n=yield i({type:"GET_PLAYLISTS",includeWatchLater:!0});t.style.cursor="pointer",n.success?function(t,n){const s=document.createElement("div");s.className="fp-playlist-dropdown",Object.assign(s.style,{position:"absolute",display:"flex",flexDirection:"column",backgroundColor:"#282828",color:"white",borderRadius:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",zIndex:"9999",width:"260px",maxHeight:"400px",fontSize:"14px",fontFamily:"Roboto, Arial, sans-serif",overflow:"hidden"});const l=t.getBoundingClientRect(),d=window.scrollX||window.pageXOffset,a=window.scrollY||window.pageYOffset;s.style.top=`${l.bottom+a+8}px`,s.style.left=`${l.left+d}px`;const r=e=>{s.contains(e.target)||e.target===t||c()},c=()=>{s.remove(),document.removeEventListener("click",r)};function p(){s.innerHTML="";const t=document.createElement("div");Object.assign(t.style,{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"}),t.innerHTML='<span style="font-size: 16px; font-weight: 500;">Save to...</span>';const l=document.createElement("div");l.innerHTML='<svg viewBox="0 0 24 24" style="width: 24px; height: 24px; fill: white; cursor: pointer;"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>',l.onclick=e=>{e.stopPropagation(),c()},t.appendChild(l),s.appendChild(t);const d=document.createElement("div");Object.assign(d.style,{overflowY:"auto",maxHeight:"200px",padding:"8px 0"});const a=o();a?0===n.length?d.innerHTML='<div style="padding: 16px; color: #aaa;">No playlists yet.</div>':n.forEach(t=>{const n=document.createElement("div");Object.assign(n.style,{display:"flex",alignItems:"center",padding:"8px 16px",cursor:"pointer",transition:"background-color 0.2s"}),n.onmouseover=()=>n.style.backgroundColor="rgba(255,255,255,0.1)",n.onmouseout=()=>n.style.backgroundColor="transparent";const o=t.video_ids&&t.video_ids.includes(a),s=o?'<svg viewBox="0 0 24 24" style="width: 24px; height: 24px; fill: #3ea6ff; margin-right: 16px;"><path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 12.17l7.59-7.59L19 6l-9 11z"></path></svg>':'<svg viewBox="0 0 24 24" style="width: 24px; height: 24px; fill: #aaa; margin-right: 16px;"><path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"></path></svg>',l=document.createElement("div");l.style.flex="1",l.style.overflow="hidden",l.style.textOverflow="ellipsis",l.style.whiteSpace="nowrap",l.textContent=t.name||"Untitled";const r="Watch Later"===t.name?'<svg viewBox="0 0 24 24" style="width: 16px; height: 16px; fill: #aaa; margin-left: 8px;"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3 3.1-3 1.71 0 3.1 1.29 3.1 3v2z"></path></svg>':"";if(n.innerHTML=`${s}`,n.appendChild(l),r){const e=document.createElement("div");e.innerHTML=r,n.appendChild(e)}n.onclick=n=>e(this,void 0,void 0,function*(){n.stopPropagation();const e=!o;e?(t.video_ids||(t.video_ids=[]),t.video_ids.push(a)):t.video_ids=t.video_ids.filter(e=>e!==a),p();const s=e?"ADD_TO_PLAYLIST":"REMOVE_FROM_PLAYLIST";try{const n=yield i({type:s,playlistId:t.id,videoId:a});n.success||(console.error("Playlist action failed",n),e?t.video_ids=t.video_ids.filter(e=>e!==a):t.video_ids.push(a),p(),alert("Failed to update playlist: "+n.error))}catch(e){console.error(e)}}),d.appendChild(n)}):d.innerHTML='<div style="padding: 16px; color: #aaa;">Could not identify video. Are you on a video page?</div>',s.appendChild(d);const r=document.createElement("div");Object.assign(r.style,{padding:"16px",borderTop:"1px solid rgba(255,255,255,0.1)",cursor:"pointer",display:"flex",alignItems:"center"}),r.innerHTML='\n        <svg viewBox="0 0 24 24" style="width: 24px; height: 24px; fill: white; margin-right: 16px;"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></svg>\n        <span style="font-weight: 500;">Create new playlist</span>\n      ',r.onmouseover=()=>r.style.backgroundColor="rgba(255,255,255,0.1)",r.onmouseout=()=>r.style.backgroundColor="transparent",r.onclick=t=>{t.stopPropagation(),function(){s.innerHTML="";const t=document.createElement("div");t.style.padding="16px",t.style.display="flex",t.style.flexDirection="column",t.style.gap="16px";const l=document.createElement("div");l.textContent="Create new playlist",l.style.fontSize="16px",l.style.fontWeight="500",l.style.marginBottom="8px";const d=document.createElement("input");Object.assign(d.style,{background:"transparent",border:"none",borderBottom:"1px solid #aaa",color:"white",outline:"none",padding:"8px 0",fontSize:"14px",width:"100%"}),d.placeholder="Playlist name...";const a=document.createElement("div");a.style.display="flex",a.style.justifyContent="flex-end",a.style.gap="8px",a.style.marginTop="16px";const r=document.createElement("button");r.textContent="Cancel",Object.assign(r.style,{background:"transparent",border:"none",color:"#aaa",cursor:"pointer",fontWeight:"500",padding:"8px 16px",textTransform:"uppercase"}),r.onclick=e=>{e.stopPropagation(),p()};const c=document.createElement("button");c.textContent="Create",Object.assign(c.style,{background:"transparent",border:"none",color:"#3ea6ff",cursor:"pointer",fontWeight:"500",padding:"8px 16px",textTransform:"uppercase"}),c.onclick=t=>e(this,void 0,void 0,function*(){t.stopPropagation();const e=d.value.trim();if(e){c.textContent="Creating...",c.disabled=!0;try{const t=yield i({type:"CREATE_PLAYLIST",name:e});if(t.success&&t.result){const e=t.result;e.video_ids||(e.video_ids=[]);const s=o();s&&e.id&&(yield i({type:"ADD_TO_PLAYLIST",playlistId:e.id,videoId:s})).success&&e.video_ids.push(s),n.push(e),p()}else alert("Error creating playlist: "+(t.error||"Unknown error")),c.textContent="Create",c.disabled=!1}catch(e){alert("Error: "+e.message),c.textContent="Create",c.disabled=!1}}}),t.appendChild(l),t.appendChild(d),a.appendChild(r),a.appendChild(c),t.appendChild(a),s.appendChild(t),d.focus()}()},s.appendChild(r)}setTimeout(()=>document.addEventListener("click",r),0),p(),document.body.appendChild(s)}(t,n.playlists):(alert("Error fetching playlists: "+n.error),n.error.includes("UserNotAuthenticated")&&alert("Please click the extension icon to login first."))}catch(e){t.style.cursor="pointer",console.error(e),alert("Communication error: "+e.message)}}}),t}function n(e){return e?e.path:""}function o(){const e=window.location.pathname.match(/\/post\/([a-zA-Z0-9_\-]+)/);if(e)return e[1];const t=new URLSearchParams(window.location.search);return t.get("video")?t.get("video"):null}function i(t){return e(this,void 0,void 0,function*(){try{return yield chrome.runtime.sendMessage(t)}catch(e){if(e.message&&e.message.includes("Extension context invalidated"))throw new Error("There was an error, please refresh and try again");throw e}})}let s=null,l=!1;function d(){a(),s=new MutationObserver(e=>{let t=!1;for(const n of e)if(n.addedNodes.length>0){t=!0;break}t&&a()}),s.observe(document.body,{childList:!0,subtree:!0})}function a(){if(l&&!document.querySelector(".fp-playlist-button")&&(l=!1),!l){const e=document.querySelector('div[class*="_buttonContainer_"]');if(e){const n=e.querySelector('div[class*="_downloadButtonWrapper_"]');if(!document.querySelector(".fp-playlist-button")){const o=t();n?e.insertBefore(o,e.firstChild):e.prepend(o),l=!0}}}document.querySelectorAll('ul[role="tablist"]').forEach(t=>{if(!t.querySelector(".fp-sidebar-playlists")){const o=t.querySelector('a[href="/browse"]');if(o){const t=function(){const t=document.createElement("a");t.className="lnav-item-base-color lnav-link-item fp-sidebar-playlists",t.draggable=!1,t.href="/playlists";const o=document.createElement("div");o.className="item-icon",o.innerHTML='\n    <svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium" focusable="false" aria-hidden="true" viewBox="0 0 24 24" style="fill: currentColor; width: 24px; height: 24px;">\n        <path d="M19 9H2v2h17V9zm0-4H2v2h17V5zM2 15h13v-2H2v2zm15-2v6l5-3-5-3z"></path>\n    </svg>\n    ';const s=document.createElement("div");return s.className="item-label",s.role="tab",s.innerHTML="<span>Playlists</span>",t.appendChild(o),t.appendChild(s),t.style.display="flex",t.style.alignItems="center",t.style.padding="10px 16px",t.style.textDecoration="none",t.style.color="inherit",t.style.cursor="pointer",t.onclick=t=>e(this,void 0,void 0,function*(){t.preventDefault(),function(){e(this,void 0,void 0,function*(){const t=document.createElement("div");t.className="fp-playlist-overlay",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0,0,0,0.9)",t.style.zIndex="10000",t.style.display="flex",t.style.flexDirection="column",t.style.padding="40px",t.style.color="white",t.style.overflowY="auto",t.style.fontFamily="Roboto, sans-serif";const o=document.createElement("div");o.style.display="flex",o.style.justifyContent="space-between",o.style.alignItems="center",o.style.marginBottom="30px",o.style.maxWidth="1200px",o.style.width="100%",o.style.alignSelf="center";const s=document.createElement("h2");s.textContent="Your Playlists",s.style.fontSize="24px",s.style.fontWeight="bold";const l=document.createElement("button");l.textContent="Close",l.style.padding="8px 24px",l.style.backgroundColor="#3e8ede",l.style.border="none",l.style.borderRadius="4px",l.style.color="white",l.style.cursor="pointer",l.style.fontWeight="bold",l.onclick=()=>t.remove(),o.appendChild(s),o.appendChild(l),t.appendChild(o);const d=document.createElement("div");d.style.maxWidth="1200px",d.style.width="100%",d.style.alignSelf="center",d.style.display="flex",d.style.flexDirection="column",t.appendChild(d);const a=document.createElement("div");d.appendChild(a),a.appendChild(function(){if(!document.getElementById("fp-skeleton-style")){const e=document.createElement("style");e.id="fp-skeleton-style",e.textContent="\n            @keyframes fp-shimmer {\n                0% { background-position: -200% 0; }\n                100% { background-position: 200% 0; }\n            }\n            .fp-skeleton {\n                background: linear-gradient(90deg, #2d2d2d 25%, #3d3d3d 50%, #2d2d2d 75%);\n                background-size: 200% 100%;\n                animation: fp-shimmer 1.5s infinite;\n                border-radius: 4px;\n            }\n        ",document.head.appendChild(e)}const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.gap="10px";for(let t=0;t<5;t++){const t=document.createElement("div");Object.assign(t.style,{padding:"16px",backgroundColor:"#2d2d2d",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"});const n=document.createElement("div");n.className="fp-skeleton",n.style.width="40%",n.style.height="24px";const o=document.createElement("div");o.className="fp-skeleton",o.style.width="15%",o.style.height="18px",t.appendChild(n),t.appendChild(o),e.appendChild(t)}return e}()),document.body.appendChild(t);try{const o=yield i({type:"GET_PLAYLISTS",includeWatchLater:!0});o.success?(a.textContent="",0===o.playlists.length?a.textContent="No playlists found.":o.playlists.forEach(o=>{const r=document.createElement("div");r.style.padding="16px",r.style.marginBottom="10px",r.style.backgroundColor="#2d2d2d",r.style.borderRadius="8px",r.style.cursor="pointer",r.style.display="flex",r.style.justifyContent="space-between",r.style.alignItems="center",r.style.transition="background-color 0.2s",r.onmouseover=()=>r.style.backgroundColor="#3d3d3d",r.onmouseout=()=>r.style.backgroundColor="#2d2d2d";const c=o.name||"Untitled",p=Array.isArray(o.video_ids)?o.video_ids.length:0;r.innerHTML=`\n            <div style="font-size: 18px; font-weight: 500;">${c}</div>\n            <div style="color: #aaa;">${p} videos</div>\n          `,r.onclick=()=>e(this,void 0,void 0,function*(){s.textContent=c,a.style.display="none";const r=document.createElement("div");if(d.appendChild(r),r.appendChild(function(){if(!document.getElementById("fp-skeleton-style")){const e=document.createElement("style");e.id="fp-skeleton-style",e.textContent="\n            @keyframes fp-shimmer {\n                0% { background-position: -200% 0; }\n                100% { background-position: 200% 0; }\n            }\n            .fp-skeleton {\n                background: linear-gradient(90deg, #2d2d2d 25%, #3d3d3d 50%, #2d2d2d 75%);\n                background-size: 200% 100%;\n                animation: fp-shimmer 1.5s infinite;\n                border-radius: 4px;\n            }\n        ",document.head.appendChild(e)}const e=document.createElement("div");e.style.display="grid",e.style.gridTemplateColumns="repeat(auto-fill, minmax(280px, 1fr))",e.style.gap="24px",e.style.marginTop="20px";for(let t=0;t<12;t++){const t=document.createElement("div");t.style.display="flex",t.style.flexDirection="column",t.style.backgroundColor="#222",t.style.borderRadius="8px",t.style.overflow="hidden";const n=document.createElement("div");n.className="fp-skeleton",Object.assign(n.style,{aspectRatio:"16/9",width:"100%"});const o=document.createElement("div");o.style.padding="12px",o.style.display="flex",o.style.gap="10px";const i=document.createElement("div");i.className="fp-skeleton",Object.assign(i.style,{width:"36px",height:"36px",borderRadius:"50%",flexShrink:"0"});const s=document.createElement("div");s.style.flex="1",s.style.display="flex",s.style.flexDirection="column",s.style.gap="6px";const l=document.createElement("div");l.className="fp-skeleton",l.style.height="16px",l.style.width="80%";const d=document.createElement("div");d.className="fp-skeleton",d.style.height="12px",d.style.width="50%",s.appendChild(l),s.appendChild(d),o.appendChild(i),o.appendChild(s),t.appendChild(n),t.appendChild(o),e.appendChild(t)}return e}()),l.textContent="Back to Playlists",l.onclick=()=>{r.remove(),a.style.display="block",s.textContent="Your Playlists",l.textContent="Close",l.onclick=()=>t.remove()},!o.video_ids||0===o.video_ids.length)return void(r.innerHTML='<div style="padding: 40px; text-align: center; color: #aaa;">No videos in this playlist.</div>');const p=yield i({type:"GET_PLAYLIST_VIDEOS",videoIds:o.video_ids});if(p.success){r.innerHTML="";const t=document.createElement("div");t.style.display="grid",t.style.gridTemplateColumns="repeat(auto-fill, minmax(280px, 1fr))",t.style.gap="24px",t.style.marginTop="20px",p.posts.forEach(s=>{var l,d,a;const r=document.createElement("a");r.href=`/post/${s.id}`,r.style.textDecoration="none",r.style.color="inherit",r.style.display="flex",r.style.flexDirection="column",r.style.backgroundColor="#222",r.style.borderRadius="8px",r.style.overflow="hidden",r.style.transform="translateY(0)",r.style.transition="transform 0.2s",r.onmouseover=()=>r.style.transform="translateY(-4px)",r.onmouseout=()=>r.style.transform="translateY(0)";const c=n(s.thumbnail),p=n(null===(l=s.creator)||void 0===l?void 0:l.icon),y=(null===(d=s.metadata)||void 0===d?void 0:d.videoDuration)?new Date(1e3*s.metadata.videoDuration).toISOString().substr(11,8).replace(/^00:/,""):"",u=document.createElement("div");if(Object.assign(u.style,{position:"relative",aspectRatio:"16/9",backgroundColor:"#000"}),c){const e=document.createElement("img");e.src=c,Object.assign(e.style,{width:"100%",height:"100%",objectFit:"cover"}),u.appendChild(e)}if(y){const e=document.createElement("div");e.textContent=y,Object.assign(e.style,{position:"absolute",bottom:"8px",right:"8px",background:"rgba(0,0,0,0.8)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold"}),u.appendChild(e)}const m=document.createElement("div");Object.assign(m.style,{position:"absolute",top:"6px",right:"6px",width:"28px",height:"28px",borderRadius:"50%",backgroundColor:"rgba(0,0,0,0.6)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"background-color 0.2s",zIndex:"10",opacity:"0"}),m.innerHTML='<svg viewBox="0 0 24 24" style="width: 18px; height: 18px; fill: white;"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>',m.onmouseover=()=>{m.style.backgroundColor="#ff0000"},m.onmouseout=()=>{m.style.backgroundColor="rgba(0,0,0,0.6)"},r.addEventListener("mouseenter",()=>{m.style.opacity="1"}),r.addEventListener("mouseleave",()=>{m.style.opacity="0"}),m.onclick=t=>e(this,void 0,void 0,function*(){if(t.preventDefault(),t.stopPropagation(),confirm("Remove this video from the playlist?")){m.style.backgroundColor="#ff0000",m.style.cursor="wait";try{const e=yield i({type:"REMOVE_FROM_PLAYLIST",playlistId:o.id,videoId:s.id});e.success?r.remove():(alert("Failed to remove video: "+e.error),m.style.backgroundColor="rgba(0,0,0,0.6)",m.style.cursor="pointer")}catch(e){alert("Error: "+e.message)}}}),u.appendChild(m),r.appendChild(u);const h=document.createElement("div");h.style.padding="12px",h.innerHTML=`\n                      <div style="display: flex; gap: 10px;">\n                          ${p?`<img src="${p}" style="width: 36px; height: 36px; border-radius: 50%; object-fit: cover;">`:""}\n                          <div style="flex: 1; min-width: 0;">\n                              <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="${s.title}">${s.title}</div>\n                              <div style="color: #aaa; font-size: 13px;">${(null===(a=s.creator)||void 0===a?void 0:a.title)||"Unknown"}</div>\n                              <div style="color: #666; font-size: 12px; margin-top: 4px;">${new Date(s.releaseDate).toLocaleDateString()}</div>\n                          </div>\n                      </div>\n                    `,r.appendChild(h),t.appendChild(r)}),r.appendChild(t)}else r.innerHTML=`<div style="color: red; padding: 20px;">Error loading videos: ${p.error}</div>`}),a.appendChild(r)})):a.textContent="Error: "+o.error}catch(e){a.textContent="Error: "+e.message}})}()}),t}();o.insertAdjacentElement("afterend",t)}}})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d()})();